/* =========================
   Global Reset + Theme
   ========================= */
*, *::before, *::after { box-sizing: border-box; }
html, body, #root, main { height: 100%; }
html, body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--ink);
  overflow: hidden;
  overscroll-behavior: none;
  touch-action: none;
}
img, svg, video, canvas { display: block; max-width: 100%; }
button, input, textarea, select { font: inherit; color: inherit; }
:focus-visible { outline: 2px solid #0A84FF; outline-offset: 2px; }

:root{
  --bg: #07090f;
  --ink: #f2f4f8;
  --ink-2: #9aa3b2;
  --stroke-1: rgba(255,255,255,.06);
  --stroke-2: rgba(255,255,255,.12);
  --glass-base: rgba(14,16,22,.36);
  --glass: color-mix(in srgb, rgba(255,255,255,0.9) 40%, var(--glass-base) 60%);
  --glass-strong: color-mix(in srgb, rgba(255,255,255,0.95) 45%, var(--glass-base) 55%);
  --shadow: 0 4px 12px rgba(0,0,0,0.5);

  --feed-max: min(100vw, 600px);
  --stripe-h: 64px;
  --orb-size: 76px;

  /* Theme accents */
  --pink: #ff74de;   /* Assistant orb theme */
  --blue: #0a84ff;   /* Brand/top-left orb theme */
  --orb-color: var(--pink);
  --orb-surface: color-mix(in srgb, #fff 65%, var(--orb-color) 35%);
  --orb-shadow: 0 12px 30px rgba(0,0,0,.35);
  --orb-ring: color-mix(in srgb, var(--orb-color) 25%, transparent 75%);
  --orb-ring-strong: color-mix(in srgb, var(--orb-color) 35%, transparent 65%);
  --orb-ping: color-mix(in srgb, var(--orb-color) 30%, transparent 70%);
  --pc-nav-size: 2rem;
  --pc-dot-btn-size: 0.5rem;
}

:root[data-theme="light"] {
  --bg: #f5f6f8;
  --ink: #0b0d12;
  --ink-2: #5b5f69;
  --stroke-1: rgba(0,0,0,.06);
  --stroke-2: rgba(0,0,0,.12);
  --glass-base: rgba(255,255,255,.65);
  --glass: color-mix(in srgb, rgba(255,255,255,0.8) 65%, var(--glass-base) 35%);
  --glass-strong: color-mix(in srgb, rgba(255,255,255,0.9) 75%, var(--glass-base) 25%);
  --shadow: 0 4px 12px rgba(0,0,0,0.08);
  --orb-color: var(--pink);
  --orb-surface: color-mix(in srgb, #fff 75%, var(--orb-color) 25%);
  --orb-shadow: 0 8px 24px rgba(0,0,0,.18);
  --orb-ring: color-mix(in srgb, var(--orb-color) 35%, transparent 65%);
  --orb-ring-strong: color-mix(in srgb, var(--orb-color) 45%, transparent 55%);
  --orb-ping: color-mix(in srgb, var(--orb-color) 40%, transparent 60%);
}

/* =========================
   App Layout Helpers
   ========================= */

/* Subtle reactive background */
.world-layer { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
.world-layer canvas { pointer-events: none !important; }
.world-bg {
  position: absolute; inset: 0;
  transition: background 600ms ease, filter 800ms ease;
  background: radial-gradient(120% 120% at 8% 12%, rgba(40,60,140,.35) 0%, #0f1326 52%, #070a17 100%);
  filter: saturate(120%);
  animation: bgShift 16s ease-in-out infinite alternate;
}
@keyframes bgShift {
  0% { filter: saturate(120%) hue-rotate(0deg); }
  100% { filter: saturate(140%) hue-rotate(25deg); }
}

/* =========================
   Post media safety net (fade in on ready) â€” FIXED
   ========================= */
.pc-media { position: relative; width: 100%; aspect-ratio: 4/5; background: #0d1320; }
.pc-media img,
.pc-media video,
.pc-media iframe,
.pc-media embed,
.pc-media model-viewer{
  position: static;                 /* no stacking */
  display: block;
  width: 100%;
  height: auto;
  object-fit: cover;
  opacity: 0;                       /* component flips to 1 on load */
  transition: opacity .25s ease;
  pointer-events: auto;             /* video controls clickable */
}

/* (optional) cover mode you can add to the container */
.pc-media.pc-media--cover img,
.pc-media.pc-media--cover video{
  position: absolute; inset: 0; width: 100%; height: 100%;
}

/* Allow full media display inside the feed without enforced cropping */
.feed-wrap .pc-media { aspect-ratio: auto; }
.feed-wrap .pc-media img,
.feed-wrap .pc-media video,
.feed-wrap .pc-media iframe,
.feed-wrap .pc-media embed,
.feed-wrap .pc-media model-viewer { object-fit: contain; }

/* Carousel controls used by PostCard */
.pc-nav{
  position:absolute; top:50%; transform:translateY(-50%);
  width:var(--pc-nav-size); height:var(--pc-nav-size); display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.45); color:#fff; border:0; border-radius:999px; cursor:pointer; z-index:3; max-width:100%; box-sizing:border-box;
}
.pc-nav.prev{ left:10px; } .pc-nav.next{ right:10px; }
.pc-dots{ position:absolute; bottom:12px; left:50%; transform:translateX(-50%); display:flex; gap:6px; z-index:3; max-width:100%; box-sizing:border-box; }
.pc-dots button{ width:var(--pc-dot-btn-size); height:var(--pc-dot-btn-size); border-radius:50%; border:0; padding:0; background:rgba(255,255,255,.5); cursor:pointer; max-width:100%; box-sizing:border-box; }
.pc-dots button.on{ background:#fff; }

/* =========================
   Assistant Orb (bottom-right floating)
   ========================= */
.assistant-orb{
  position: fixed; z-index: 75;
  width: var(--orb-size); height: var(--orb-size);
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,.12);
  overflow: hidden; cursor: grab;
  display: grid; place-items: center;
  contain: layout paint;
  will-change: transform;
  transition: transform .16s ease, box-shadow .2s ease, filter .2s ease;
  background: radial-gradient(120% 120% at 30% 30%, #fff, var(--orb-surface) 60%, var(--orb-color));
  box-shadow: var(--orb-shadow), 0 0 0 8px var(--orb-ring);
}
.assistant-orb:hover { filter: saturate(115%); }
.assistant-orb.flying { pointer-events: none; filter: saturate(150%); transition: none; }
.assistant-orb.mic {
  box-shadow: var(--orb-shadow), 0 0 0 10px var(--orb-ring-strong);
}
.assistant-orb__core{
  width: 56px; height: 56px; border-radius: 50%;
  background: radial-gradient(60% 60% at 40% 35%, rgba(255,255,255,.95), rgba(255,255,255,.28) 65%, transparent 70%);
}
.assistant-orb__ring{
  position: absolute; inset: -4px; border-radius: 50%;
  box-shadow: inset 0 0 24px rgba(255,255,255,.55);
}
.assistant-orb.mic .assistant-orb__ring{ animation: orb-ping 1.4s ease-out infinite; }
@keyframes orb-ping{
  0%   { box-shadow: 0 0 0 0 var(--orb-ping); }
  100% { box-shadow: 0 0 0 28px rgba(0,0,0,0); }
}
.assistant-orb__toast{
  position: absolute;
  white-space: nowrap; padding: 6px 8px; border-radius: 8px;
  background: rgba(0,0,0,.65); color: #fff; font-size: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,.25); pointer-events: none;
}
.assistant-orb__toast.right { left: calc(100% + 8px); top: 50%; transform: translateY(-50%); }
.assistant-orb__toast.left { right: calc(100% + 8px); top: 50%; transform: translateY(-50%); }
.assistant-orb__toast.interim { bottom: calc(100% + 4px); top: auto; transform: none; }

.assistant-panel{
  position: fixed; z-index: 9998;
  width: 320px; max-width: 40vw;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 12px 36px rgba(0,0,0,0.45);
  backdrop-filter: blur(8px) saturate(120%);
  animation: panelIn .2s ease;
}
@keyframes panelIn {
  from { opacity: 0; transform: scale(0.98) translateY(8px); }
  to   { opacity: 1; transform: scale(1) translateY(0); }
}

/* =========================
   Assistant Drawer (petal)
   ========================= */
.assistant-petal{
  position: fixed; z-index: 76;
  left: 50%; bottom: 12px; transform: translateX(-50%);
  width: min(680px, 92vw);
  max-height: 80vh; display: flex; flex-direction: column;
  background: rgba(26,28,38,.72);
  border: 1px solid rgba(255,255,255,.16);
  border-radius: 16px;
  -webkit-backdrop-filter: blur(18px) saturate(180%);
  backdrop-filter: blur(18px) saturate(180%);
  box-shadow: 0 18px 48px rgba(0,0,0,.45);
  overflow: hidden;
  animation: petalIn .28s cubic-bezier(.18,.9,.22,1);
}
@keyframes petalIn {
  from { transform: translate(-50%, 10%) scale(.98); opacity: 0; }
  to   { transform: translate(-50%, 0) scale(1); opacity: 1; }
}
.ap-head{
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,.12);
}
.ap-dot{
  width: 22px; height: 22px; border-radius: 999px;
  border: 1px solid rgba(255,255,255,.2);
  box-shadow: 0 0 0 4px var(--orb-ring);
  background: radial-gradient(120% 120% at 30% 30%, #fff, var(--orb-surface) 60%, var(--orb-color));
}
.ap-title{ font-weight: 800; }
.ap-sub{ font-size: 12px; opacity: .8; }
.ap-btn{
  margin-left: auto; height: 28px; padding: 0 10px; border-radius: 8px; cursor: pointer;
  background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.16); color: #fff;
}

.ap-emojis{
  display: flex; flex-wrap: wrap; gap: 8px; padding: 10px 12px;
  max-height: 200px; overflow-y: auto;
}
.emoji-btn{
  background: none; border: none; cursor: pointer;
  font-size: 24px; padding: 4px; border-radius: 6px;
  transition: transform .1s ease, background .1s ease;
}
.emoji-btn:hover{ background: rgba(255,255,255,.10); transform: scale(1.1); }

.ap-body{
  padding: 10px 12px; overflow: auto; display: flex; flex-direction: column; gap: 8px;
  max-height: 280px;
}
.ap-hint{ opacity: .8; }
.ap-msg{ display: flex; }
.ap-msg.user{ justify-content: flex-end; }
.ap-msg-bubble{
  max-width: 78%;
  background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.16);
  padding: 8px 10px; border-radius: 12px;
}
.ap-msg.user .ap-msg-bubble{ background: rgba(255,255,255,.14); }

.ap-form{
  display: flex; gap: 8px; padding: 10px 12px;
  border-top: 1px solid rgba(255,255,255,.12);
}
.ap-input{
  flex: 1; height: 36px; padding: 0 10px; border-radius: 10px;
  outline: 0; background: rgba(16,18,28,.65); border: 1px solid rgba(255,255,255,.16); color: #fff;
}
.ap-mic, .ap-send{
  height: 36px; padding: 0 10px; border-radius: 10px; cursor: pointer;
  background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.16); color: #fff;
}
.ap-mic.on{ box-shadow: inset 0 0 0 3px var(--orb-ping); }

/* =========================
   World UI (bottom glass bar)
   ========================= */
.world-bottombar{
  position: fixed; left: 12px; right: 12px; bottom: 12px; z-index: 65;
  display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 12px;
  background: rgba(10,12,20,.55); color: #fff;
  -webkit-backdrop-filter: blur(10px) saturate(140%);
  backdrop-filter: blur(10px) saturate(140%);
}
.world-bottombar .crumb{ opacity: .8; font-size: 12px; }
.pill{
  background: #141827; color: #fff; border: 1px solid var(--stroke-2); border-radius: 999px;
  padding: 8px 12px; font-weight: 700; cursor: pointer;
}
.pill:hover{ box-shadow: inset 0 0 0 2px rgba(255,255,255,.08); }

/* =========================
   Portal Overlay (white burst)
   ========================= */
.portal-overlay {
  position: fixed; inset: 0; pointer-events: none; z-index: 9999;
  --px: 50vw; --py: 50vh; --r0: 0px;
  background: radial-gradient(circle at var(--px) var(--py),
    rgba(255,255,255,1) 0%,
    rgba(255,255,255,1) 60%,
    rgba(255,255,255,.98) 70%,
    rgba(255,255,255,0) 71%);
  clip-path: circle(var(--r0) at var(--px) var(--py));
  opacity: 0;
  transition: clip-path .65s cubic-bezier(.22,.61,.36,1), opacity .2s ease;
}
.portal-overlay.on { --r0: 160vmax; opacity: 1; }
